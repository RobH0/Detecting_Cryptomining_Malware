#Rules
from recorder import Recorder

# Checks whether cpu utilisation of data passed is suspiciously high
class CPUPercentageCheck():

    def __init__(self):
        pass

    def check(cpuMonitoringData):
        metOnce = False

        for x in cpuMonitoringData[1:len(cpuMonitoringData)]:
            if(float(x) >= 60):
                metOnce = True
            else:
                metOnce = False
        return metOnce


# Checks whether memory consumption of data passed is suspiciously high
class MemoryUsageCheck():

    def __init__(self):
        pass

    def check(memoryMonitoringData):
        for x in memoryMonitoringData[1:len(memoryMonitoringData)]:
            if(float(x) >= 1.38):
                return True
            else:
                return False


class SustainedHighCPUCheck():

    def __init__(self):
        print("SustainedHighCPUCheck")

    def check(process):##need to pass process name to rules
        detectionHist = Recorder(False).readDetectionHistory()
        print("here")
        processDict = detectionHist[process]
        print("here2")
        print(f"processDict {processDict}")
        detectionCount = processDict["CPUPercentageCheck"]
        print(f"detectionCount {detectionCount}")

        if detectionCount % 4 == 0:
            return True
        else:
            return False
        #print(f"process {process}")

class SustainedHighMemoryCheck():

    def __init__(self):
        print("SustainedHighMemoryCheck")

    def check(process):
        rec = Recorder(False)
        detectionHist = rec.readDetectionHistory()
        print("here")

        processDict = detectionHist[process]
        print("here2")
        print(f"processDict {processDict}")
        detectionCount = processDict["MemoryUsageCheck"]
        print(f"detectionCount {detectionCount}")

        if detectionCount % 4 == 0:
            return True
        else:
            return False
        print(f"process {process}")
        print(f"detection Hist: {detectionHist}")
