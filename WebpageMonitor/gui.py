#gui.py
from PyQt5.QtWidgets import *
from PyQt5.QtCore import *



class GUI:

    def __init__(self, mainProgram):
        self.app = QApplication([])
        self.window = QWidget()
        self.layout = QVBoxLayout()
        self.alertLabel = QLabel("Crypto mining: not detected")
        self.label = None
        self.button = None
        self.stopMonButton = QPushButton('Stop monitoring')
        self.stopMonButton.setCheckable(True)
        self.mainProg = mainProgram

    def mainGUI(self):
        self.label = QLabel('DetectCryptoMining')
        self.button = QPushButton('Start monitoring')
        self.button.clicked.connect(self.startMonitoring)
        self.layout.addWidget(self.label)
        self.layout.addWidget(self.alertLabel)
        self.layout.addWidget(self.button)
        self.layout.addWidget(self.stopMonButton)
        self.window.setLayout(self.layout)
        self.window.show()
        self.app.exec_()

    def notifyUserOfActivity(self, rulesMetList):
        lenRuleList = len(rulesMetList)
        alertString = "Crypto mining: Detected\n" + "The following detection rules were met: "
        for rule in rulesMetList:
            if rulesMetList.index(rule) != (lenRuleList-1):
                alertString += rule + ", "
            else:
                alertString += rule + "."
        self.alertLabel.setText(alertString)


    def startMonitoring(self):
        self.mainProg.main()

    def stopMonitoring(self):
        pass

    def checkStop(self):
        QCoreApplication.processEvents()
        if self.stopMonButton.isChecked():
            self.stopMonButton.toggle()
            return True
        else:
            return False
